<!DOCTYPE html>
<html>

<head>
  <title>douban.fm</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="../../asset/style/style.css">
</head>

<body>
  <div class="mainWrapper">

    <div class="component col-left">
      <img id="pausePlayButton" src="../../asset/icon/pause-button-white.svg">
    </div>

    <div class="component col-middle">
      <p id="songName" class="song-text song-text-big"> </p>
      <p id="songArtist" class="song-text song-text-small"> </p>
      <video autoplay id="video" height="0px" src=""></video>
    </div>

    <div class="component col-right">
      <div class="col-right-up song-text-small">sfds</div>
      <div class="col-right-down">
        <img id="nextButton" class="col-right-down-button" src="../../asset/icon/next-button-white.svg">
        <img id="likeButton" class="col-right-down-button" src="../../asset/icon/like-button-white.svg">
      </div>
    </div>
  </div>
</body>

<script>
  const electron = require("electron");
  const path = require("path");
  const { ipcRenderer } = electron;

  const video = document.querySelector("#video");
  const songName = document.querySelector("#songName");
  const songArtist = document.querySelector("#songArtist");
  const pausePlayButton = document.querySelector("#pausePlayButton");
  const nextButton = document.querySelector("#nextButton");
  const likeButton = document.querySelector("#likeButton");

  let paused = false;

  // default video
  video.src = path.join(__dirname, "..", "..", "..", "src", "asset", "media", "silence.mp4");

  let currentSong = null;

  /**
   * pausePlayButton event listeners
  */
  pausePlayButton.addEventListener("mouseover", (e) => {
    if (paused) {
      pausePlayButton.src = "../../asset/icon/play-button-black.svg";
    } else {
      pausePlayButton.src = "../../asset/icon/pause-button-black.svg";
    }
  });

  pausePlayButton.addEventListener("mouseout", (e) => {
    if (paused) {
      pausePlayButton.src = "../../asset/icon/play-button-white.svg";
    } else {
      pausePlayButton.src = "../../asset/icon/pause-button-white.svg";
    }
  });

  pausePlayButton.addEventListener("click", (e) => {
    if (paused) {
      video.play();
      paused = false;
      pausePlayButton.src = "../../asset/icon/pause-button-white.svg";
    } else {
      video.pause();
      paused = true;
      pausePlayButton.src = "../../asset/icon/play-button-white.svg";
    }
  })

  /**
   * nextButton event listeners
  */
  nextButton.addEventListener("mouseover", (e) => {
    nextButton.src = "../../asset/icon/next-button-black.svg";
  });

  nextButton.addEventListener("mouseout", (e) => {
    nextButton.src = "../../asset/icon/next-button-white.svg";
  });

  nextButton.addEventListener("click", (e) => {
    e.preventDefault();
    ipcRenderer.send("player:getNextSong", currentSong);

    paused = false;
    pausePlayButton.src = "../../asset/icon/pause-button-white.svg";
  });

  /**
   * likeButton event listeners
  */
  likeButton.addEventListener("mouseover", (e) => {
    likeButton.src = "../../asset/icon/like-button-black.svg";
  });

  likeButton.addEventListener("mouseout", (e) => {
    likeButton.src = "../../asset/icon/like-button-white.svg";
  });

  ipcRenderer.on("player:receiveNextSong", (event, val) => {
    currentSong = val;

    songName.innerHTML = val.title;
    songArtist.innerHTML = val.artist;
    video.src = val.url;
  });

  // TODO: add length text

  // TODO: move according to current time
</script>

</html>