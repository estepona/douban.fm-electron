<!DOCTYPE html>
<html>

<head>
  <title>douban.fm</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div class="mainWrapper">

    <div class="component column-left">
      <img id="pausePlayButton" src="icon/pause-button-white.svg" height="60px" width="60px" />
    </div>

    <div class="component column-middle">
      <div height="30px">
        <span id="songName"
          style="font-size:20px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;font-weight:400;color:rgb(3,3,3)">
        </span>
      </div>
      <div height="20px">
        <span id="songArtist"
          style="font-size:15px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;font-weight:400;color:rgb(74,74,74)">
        </span>
      </div>
      <video autoplay id="video" height="0px" src=""></video>
    </div>

    <div class="component column-right">
      <img id="nextButton" class="icon" src="icon/next-button-white.svg" height="30px" width="30px" />
      <img id="likeButton" class="icon" src="icon/like-button-white.svg" height="30px" width="30px" />
    </div>
  </div>
</body>

<script>
  const electron = require("electron");
  const path = require("path");
  const { ipcRenderer } = electron;

  const video = document.querySelector("#video");
  const songName = document.querySelector("#songName");
  const songArtist = document.querySelector("#songArtist");
  const pausePlayButton = document.querySelector("#pausePlayButton");
  const nextButton = document.querySelector("#nextButton");
  const likeButton = document.querySelector("#likeButton");

  let paused = false;

  // default video
  video.src = path.join(__dirname, "silence.mp4");

  let currentSong = null;

  /**
   * pausePlayButton event listeners
  */
  pausePlayButton.addEventListener("mouseover", (e) => {
    if (paused) {
      pausePlayButton.src = "icon/play-button-black.svg";
    } else {
      pausePlayButton.src = "icon/pause-button-black.svg";
    }
  });

  pausePlayButton.addEventListener("mouseout", (e) => {
    if (paused) {
      pausePlayButton.src = "icon/play-button-white.svg";
    } else {
      pausePlayButton.src = "icon/pause-button-white.svg";
    }
  });

  pausePlayButton.addEventListener("click", (e) => {
    if (paused) {
      video.play();
      paused = false;
      pausePlayButton.src = "icon/pause-button-white.svg";
    } else {
      video.pause();
      paused = true;
      pausePlayButton.src = "icon/play-button-white.svg";
    }
  })

  /**
   * nextButton event listeners
  */
  nextButton.addEventListener("mouseover", (e) => {
    nextButton.src = "icon/next-button-black.svg";
  });

  nextButton.addEventListener("mouseout", (e) => {
    nextButton.src = "icon/next-button-white.svg";
  });

  nextButton.addEventListener("click", (e) => {
    e.preventDefault();
    ipcRenderer.send("player:getNextSong", currentSong);

    paused = false;
    pausePlayButton.src = "icon/pause-button-white.svg";
  });

  /**
   * likeButton event listeners
  */
  likeButton.addEventListener("mouseover", (e) => {
    likeButton.src = "icon/like-button-black.svg";
  });

  likeButton.addEventListener("mouseout", (e) => {
    likeButton.src = "icon/like-button-white.svg";
  });

  ipcRenderer.on("player:receiveNextSong", (event, val) => {
    currentSong = val;

    songName.innerHTML = val.title;
    songArtist.innerHTML = val.artist;
    video.src = val.url;
  });

  // TODO: add length text

  // TODO: move according to current time
</script>

</html>