<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>douban.fm</title>
</head>

<style>
  #progressBarParent {
    width: 430px;
    background-color: #ddd;
  }

  #progressBar {
    width: 1%;
    height: 10px;
    background-color: #4CAF50;
  }
</style>

<body>
  <div height="30px">
    <div height="30px">
      <span id="songName"
        style="font-size:20px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;font-weight:400;color:rgb(3,3,3)">
      </span>
    </div>
    <div height="20px">
      <span id="songArtist"
        style="font-size:15px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;font-weight:400;color:rgb(74,74,74)">
      </span>
    </div>
  </div>

  <div id="progressBarParent">
    <div id="progressBar"></div>
  </div>

  <video autoplay id="video" height="0px" src=""></video>

  <div id="buttons" style="position:absolute;width:300px">
    <img id="pausePlayButton" src="icon/pause-button-thin.svg" height="30px" width="30px" />
    <img id="nextButton" src="icon/next-button-white.svg" height="30px" width="30px" />
    <img id="likeButton" src="icon/like-button-white.svg" height="30px" width="30px" />
  </div>

</body>

<script>
  const electron = require("electron");
  const path = require("path");
  const { ipcRenderer } = electron;

  const video = document.querySelector("#video");
  const songName = document.querySelector("#songName");
  const songArtist = document.querySelector("#songArtist");
  const pausePlayButton = document.querySelector("#pausePlayButton");
  const nextButton = document.querySelector("#nextButton");
  const likeButton = document.querySelector("#likeButton");

  let paused = false;

  // default video
  video.src = path.join(__dirname, "silence.mp4");

  let currentSong = null;

  /**
   * pausePlayButton event listeners
  */
  pausePlayButton.addEventListener("mouseover", (e) => {
    if (paused) {
      pausePlayButton.src = "icon/play-button-black.svg";
    } else {
      pausePlayButton.src = "icon/pause-button-thick.svg";
    }
  });

  pausePlayButton.addEventListener("mouseout", (e) => {
    if (paused) {
      pausePlayButton.src = "icon/play-button-white.svg";
    } else {
      pausePlayButton.src = "icon/pause-button-thin.svg";
    }
  });

  pausePlayButton.addEventListener("click", (e) => {
    if (paused) {
      video.play();
      paused = false;
      pausePlayButton.src = "icon/pause-button-thin.svg";
    } else {
      video.pause();
      paused = true;
      pausePlayButton.src = "icon/play-button-white.svg";
    }
  })

  /**
   * nextButton event listeners
  */
  nextButton.addEventListener("mouseover", (e) => {
    nextButton.src = "icon/next-button-black.svg";
  });

  nextButton.addEventListener("mouseout", (e) => {
    nextButton.src = "icon/next-button-white.svg";
  });

  nextButton.addEventListener("click", (e) => {
    e.preventDefault();
    ipcRenderer.send("player:getNextSong", currentSong);

    paused = false;
    pausePlayButton.src = "icon/pause-button-thin.svg";
  });

  /**
   * likeButton event listeners
  */
  likeButton.addEventListener("mouseover", (e) => {
    likeButton.src = "icon/like-button-black.svg";
  });

  likeButton.addEventListener("mouseout", (e) => {
    likeButton.src = "icon/like-button-white.svg";
  });

  ipcRenderer.on("player:receiveNextSong", (event, val) => {
    currentSong = val;

    songName.innerHTML = val.title;
    songArtist.innerHTML = val.artist;
    video.src = val.url;
  });

  // TODO: add length text

  // TODO: move according to current time
  const moveProgressBar = () => {
    const bar = document.getElementById("progressBar");

    const update = () => {
      if (width >= 100) {
        clearInterval(iv);
      } else {
        width++;
        bar.style.width = String(width) + '%';
      }
    };

    let width = 1;
    let iv = setInterval(update, 10);
  }

  moveProgressBar();
</script>

</html>